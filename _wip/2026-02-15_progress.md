# 2026-02-15 進捗レポート

## 目的

0〜999 の各数字ページを、数学的性質だけでなく、Wikipedia の要点（要約）・文化的ないわれ・技術運用（HTTP ステータスコード、74xx ロジック番号）まで拾えるテンプレート/生成物に拡張する。

## 変更点の要約

- 数字ページのテンプレートを増強（Wikipedia要点、規格・コードの章を追加）
- 生成スクリプトを拡張し、全ページに上記章立てを自動出力
  - `100–599` は HTTP ステータスコードとしての導線（MDN + 参照リポジトリ）を追加
  - 74xx 系ロジック番号としての導線（enwiki の一覧リンク）を追加
  - 代表的なロジック番号の機能は「目安」として一部だけ自動記載（断定を避ける）
  - Wikipedia「性質」だけでなく「その他」セクションからも短い引用を抽出し、`その他（要約）` に自動反映（出典URL/CC BY-SA/整形有無を明記）

  - Wikipedia『性質』『その他』の引用採用を改善（重要度指数）
    - 重要度指数 = 有名度(1〜10) × 固有度(1〜10)（1〜100）
    - 有名度: Wikipedia検索（MediaWiki API）の `totalhits` をログスケールで 1..10 にマップ
    - 固有度: 0..999の候補群から抽出した“用語”の頻度（希少性）をログスケールで 1..10 にマップ
    - 閾値以上を優先し、不足分はスコア上位から補完
    - 検索回数抑制のため `totalhits` はキャッシュし再利用
      - キャッシュ: `tools/_cache/wikipedia_ja_searchhits_v1.json`
    - 特定の引用を必ず採用したい場合はピン留め設定で強制採用できるようにした
      - 設定ファイル: `tools/wikipedia_ja_pins_v1.json`
    - 数字ごと・種別ごとに閾値を調整したい場合は上書き設定で対応できるようにした
      - 設定ファイル: `tools/wikipedia_ja_importance_overrides_v1.json`

  - リポジトリライセンスを CC BY-SA 4.0 に決定（Wikipedia 等の取り込み時のライセンス整合を取りやすくする意図）

- Wikidata（CC0）連携を追加し、ページ内容を自動拡充
  - 数そのものの Wikidata 項目（説明の要約＋リンク）
  - ISO 3166-1 numeric（3桁の国・地域コード）
  - 国番号（国際電話・E.164。数字のみの国番号に限定）
  - キャッシュ: `tools/_cache/`（Git管理しない）
  - オプション: `--no-wikidata` / `--refresh-wikidata`

- Wikipedia（日本語）連携を追加し、各数字ページの Wikipedia 冒頭（概要）を短く要約して反映
  - 方針: 長文転載を避け、冒頭1文など最小限の短い引用 + 参照リンクに留める
  - キャッシュ: `tools/_cache/`（Git管理しない）
  - オプション: `--no-wikipedia` / `--refresh-wikipedia`

- 数式（KaTeX）運用を前提に、VS Code / 指示書 / 生成を整備
  - VS Code 推奨拡張として Markdown KaTeX を追加（Markdown プレビューで `$...$` / `$$...$$` をレンダリング）
  - Copilot 指示書に KaTeX 記法のルールを明文化（`\(...\)`/`\[...\]` は使わず `$` を使う、生成物は生成側で整形、Wikipedia 引用は改変しない等）
  - 素因数分解など、既存の「指数 `^` + 乗算 `×`」表記を KaTeX に正規化して出力（例: `$2^{4} \times 59$`）
  - Wikipedia「性質」セクション由来の短い引用を追加し、数式表記が含まれる場合は **整形版（改変あり）** として KaTeX 化して掲載
    - 例: `π = 3.1415…` などを「短い引用・整形」として `「$\pi = 3.1415\dots$ …」` のように整形して記載（改変がある旨を明記）
    - Wikipedia「性質」セクションの取得はキャッシュ優先。ただし **指定した数字のうちキャッシュ欠落があれば追記取得してマージ**（部分生成でも欠落しにくくする）
      - 強制更新: `--refresh-wikipedia-sections`
    - KaTeX 整形で `re.sub` 置換文字列のバックスラッシュ扱いに起因するクラッシュを修正（例: `^3√31` → `\sqrt[3]{31}`）

- 生成時のネットワーク不安定対策として `--offline` を追加
  - キャッシュ（`tools/_cache/`）は読むが、Wikipedia/Wikidata へのネットワーク取得は行わない
  - 分割生成（`--only 0-99` 等）を連続実行してもハングしにくく、全量再生成を完走しやすい

## 追加対応（同日・続き）

- Wikipedia『性質』『その他』引用の採用を pins 設定で調整（例: 42 の「銀河ヒッチハイク・ガイド」表記揺れ対応）
- 各数字ページに「リポジトリ内リンク」（`index.md` と近傍 ±1/±10/±100 への相対リンク）を自動付与
- 内部リンク検査スクリプト `tools/check_internal_links.py` を追加し、生成後のリンク切れ確認を自動化
- VS Code タスクに「Check internal links」を追加
- README / 指示書を更新し、Wikipedia セクション引用の運用（`--wikipedia-sections` / pins / overrides / `--offline`）を明文化
- 公開ドキュメントから個人環境の絶対パスを排除（README / 指示書 / VS Code Tasks を相対・汎用化）
- 0〜999 の再生成を実施（内容が同一の場合は差分が出ないことがある）
- `index.md` → `numbers/**` の内部リンク整合を機械チェックし、リンク切れが無いことを確認（1000リンク）

## 影響範囲（編集したファイル）

- `_template/number.md`
- `tools/generate_numbers.py`
- `tools/wikidata_cc0.py`
- `tools/wikipedia_ja.py`
- `.github/copilot-instructions.md`
- `.vscode/extensions.json`
- `.vscode/settings.json`
- `numbers/**`（再生成）

## 未完了タスク

- Wikipedia「性質」「その他」の“要点”を、必要に応じて追加で充実（全文転載は避け、要約＋参照リンク中心）
- `--wikipedia-sections` を 0..999 全件に対して使う場合の運用整理（キャッシュ構築/更新の方針、実行時間、ネットワーク不可時の扱い）
- Wikidata 連携で扱うカテゴリの追加（例: ISO 4217 numeric 等、追加する場合はプロパティID根拠を明示）

## 参考リンク

- Wikipedia（例: 31）: https://ja.wikipedia.org/wiki/31
- Wikipedia（例: 42）: https://ja.wikipedia.org/wiki/42
- 7400シリーズ一覧: https://en.wikipedia.org/wiki/List_of_7400-series_integrated_circuits
- HTTP ステータスコード チートシート: https://github.com/radiann-kswg/CheatSheet-of_HttpResponceDataCode
- Wikidata Query Service: https://query.wikidata.org/
- Wikidata データアクセス: https://www.wikidata.org/wiki/Wikidata:Data_access
